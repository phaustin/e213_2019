

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Solving Ordinary Differential Equations &#8212; Numeric course 0.1 documentation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link href="../_static/css/index.css" rel="stylesheet">
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">

<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
</button>

<div id="navbar-menu" class="collapse navbar-collapse">
  <ul id="navbar-main-elements" class="navbar-nav mr-auto">
    <li class="nav-item">
        <a class="nav-link" href="../index.html">Home</a>
    </li>
    
    
    <li class="nav-item ">
        <a class="nav-link" href="../learning_goals/learning_goals.html">Learning goals</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../week_notes.html">Weekly notes</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../solutions.html">Assignment solutions</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../texts.html">Texts</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../getting_started.html">Python</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../cheat_sheet.html">Cheat sheet</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../notebook_index.html">Notebook index</a>
    </li>
    
    
  </ul>
  <ul class="navbar-nav ml-auto">
    
    
  </ul>
</div>
    </nav>
    

    <div class="container-fluid">
      <div class="row">
          
          <div class="col-12 col-md-3 col-xl-2 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              


<div class="tocsection onthispage"><i class="fas fa-list"></i> On this page</div>
<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Objectives" class="nav-link">Objectives</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Introduction" class="nav-link">Introduction</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Euler’s-methods" class="nav-link">Euler’s methods</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#From-the-mass-balance-to-the-ODE" class="nav-link">From the mass balance to the ODE</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#Source-and-sink-terms" class="nav-link">Source and sink terms</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#ODE" class="nav-link">ODE</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#Asymptotic-behavior" class="nav-link">Asymptotic behavior</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Analytical-Solution" class="nav-link">Analytical Solution</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Integral-form-of-the-ODE" class="nav-link">Integral form of the ODE</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#Euler’s-approach" class="nav-link">Euler’s approach</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#Forward-Euler" class="nav-link">Forward Euler</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#Backward-Euler" class="nav-link">Backward Euler</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Examples-of-application" class="nav-link">Examples of application</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Runge-Kutta-methods" class="nav-link">Runge Kutta methods</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>
              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<h1><p>Table of Contents</p>
</h1><div class="toc"><ul class="toc-item"><li><p>1  Solving Ordinary Differential Equations</p>
<ul class="toc-item"><li><p>1.1  Objectives</p>
</li><li><p>1.2  Introduction</p>
</li><li><p>1.3  Euler’s methods</p>
<ul class="toc-item"><li><p>1.3.1  From the mass balance to the ODE</p>
</li><li><p>1.3.2  Analytical Solution</p>
</li></ul></li><li><p>1.4  Integral form of the ODE</p>
<ul class="toc-item"><li><p>1.4.1  Euler’s approach</p>
</li><li><p>1.4.2  Examples of application</p>
</li><li><p>1.4.3  Runge Kutta methods</p>
</li></ul></li></ul></li></ul></div><div class="section" id="Solving-Ordinary-Differential-Equations">
<h1>Solving Ordinary Differential Equations<a class="headerlink" href="#Solving-Ordinary-Differential-Equations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Objectives">
<h2>Objectives<a class="headerlink" href="#Objectives" title="Permalink to this headline">¶</a></h2>
<p>In this lecture, we will review the main computational techniques to solve a first order differential problem (initial value problem) of the type:</p>
<p><span class="math">\begin{equation}
\left\lbrace
\begin{array}{lll}
\displaystyle{\frac{dy}{dt}} & = & f(y,t) \\
y(t_0) & = & y_0
\end{array}
\right.
\end{equation}</span></p>
<p>Specifically you will be able to:</p>
<ul class="simple">
<li><p>link the ODE to a physical problem</p></li>
<li><p>develop different computational methods to solve the initial value problem</p></li>
<li><p>understand the concept of stability and accuracy of a computation methods</p></li>
<li><p>describe Euler forward and backward approaches</p></li>
</ul>
</div>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>Ordinary differential equations (ODEs) arise in many physical situations. For example, there is the second-order Newton’s Second Law of Mechanics <span class="math notranslate nohighlight">\(F=ma\)</span> .</p>
<p>In general, higher-order equations, such as Newton’s force equation, can be rewritten as a system of first-order equations. So the generic problem in ODEs is a set of N coupled first-order differential equations of the form defined above.</p>
<div class="math notranslate nohighlight">
\[\frac{d{\bf y}}{dt} = f({\bf y},t)\]</div>
<p>where <span class="math notranslate nohighlight">\({\bf y}\)</span> is a vector of variables. As an example, the Newton’s law of motion could be written as</p>
<div class="math notranslate nohighlight">
\[M\frac{d^2 x}{dt^2} = F(x,t)\]</div>
<p>Which is a second order differential equation. But nothing can prevent us from describing the same problem through two first-order coupled ODEs:</p>
<p><span class="math">\begin{equation}
\left\lbrace
\begin{array}{lll}
\displaystyle{\frac{dx}{dt}} & = & v_x(x,t) \\
\displaystyle{m\frac{dv_x}{dt}} & = & F(x,t) \\
\end{array}
\right.
\end{equation}</span></p>
<p>That means that we can limit our next discussions to the first order problems.</p>
</div>
<div class="section" id="Euler’s-methods">
<h2>Euler’s methods<a class="headerlink" href="#Euler’s-methods" title="Permalink to this headline">¶</a></h2>
<p>In engineering, conceptual models will describe how a certain quantity (mass, energy, position, …) will evolve: it is about identifying which processes will affect that quantity, and translate them into a mathematical form.</p>
<div class="section" id="From-the-mass-balance-to-the-ODE">
<h3>From the mass balance to the ODE<a class="headerlink" href="#From-the-mass-balance-to-the-ODE" title="Permalink to this headline">¶</a></h3>
<div class="section" id="Source-and-sink-terms">
<h4>Source and sink terms<a class="headerlink" href="#Source-and-sink-terms" title="Permalink to this headline">¶</a></h4>
<p>For the sulfates TMF problem, we had identified 4 contributions to the sulfate concentration.</p>
<ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\(M_{\text{pit}}\)</span> is the mass of sulfates added over <span class="math notranslate nohighlight">\(\Delta t\)</span> from the mill (mg).</p></li>
<li><p><span class="math notranslate nohighlight">\(M_{\text{mill}}\)</span> is the mass of sulfates added over <span class="math notranslate nohighlight">\(\Delta t\)</span> from the pit (mg).</p></li>
<li><p><span class="math notranslate nohighlight">\(M_{\text{pore}}\)</span> is the mass of sulfates added over <span class="math notranslate nohighlight">\(\Delta t\)</span> from that exchange term with the tailings porewater (mg)</p></li>
<li><p><span class="math notranslate nohighlight">\(M_{\text{discharge}}\)</span> is the mass of sulfates removed over <span class="math notranslate nohighlight">\(\Delta t\)</span> from the discharge flux (mg)</p></li>
</ol>
<p>Therefore, if the mass of sulfates at a certain time <span class="math notranslate nohighlight">\(t_0\)</span> is <span class="math notranslate nohighlight">\(m(t_0) = m_0\)</span>, the mass of sulfates at <span class="math notranslate nohighlight">\(t_0 + \Delta t\)</span> is: <span class="math">\begin{equation}
m(t_0 + \Delta t) = m(t_0) + M_{\text{pit}} + M_{\text{mill}} + M_{\text{pore}} - M_{\text{dis}}
\end{equation}</span></p>
<p>And we have identified these terms:</p>
<p><span class="math">\begin{equation}
\left\lbrace
\begin{array}{lll}
M_{\text{pit}} & = & Q_{\text{pit}}c_{\text{pit}} \Delta t\\
M_{\text{mill}} & = & Q_{\text{mill}}c_{\text{mill}} \Delta t\\
M_{\text{pore}} & = & kA_{\text{bottom}}(c_{\text{pore}} - c_{\text{TMF}}) \Delta t\\
M_{\text{discharge}} & = & Q_{\text{dis}}c_{\text{TMF}} \Delta t\\
\end{array}
\right.
\end{equation}</span></p>
<p>So we can rewrite the previous equation as:</p>
<p><span class="math">\begin{equation}
\begin{array}{llll}
& m(t_0 + \Delta t) & = & m(t_0) + M_{\text{pit}} + M_{\text{mill}} + M_{\text{pore}} - M_{\text{dis}} \\
\Longleftrightarrow & m(t_0 + \Delta t) & = & m(t_0) + \left(Q_{\text{pit}}  c_{\text{pit}} + Q_{\text{mill}}  c_{\text{mill}} + A_{\text{bottom}} k \left( c_{\text{pore}} - c_{\text{TMF}}  \right)    -Q_{\text{dis}} c_{\text{TMF}}\right) \Delta t \\
\Longleftrightarrow & \frac{m(t_0 + \Delta t)-m(t_0)}{\Delta t} & = &  Q_{\text{pit}}  c_{\text{pit}} + Q_{\text{mill}}  c_{\text{mill}} + A_{\text{bottom}} k \left( c_{\text{pore}} - c_{\text{TMF}}  \right)    -Q_{\text{dis}} c_{\text{TMF}}  \\
\end{array}
\end{equation}</span></p>
<p>The link between concentration and mass of sulfates is the volume of water <span class="math">\begin{equation}
c_{\text{TMF}}(t) = \frac{m(t)}{V(t)}
\end{equation}</span></p>
<p>But, since the volume of water is constant (<span class="math notranslate nohighlight">\(V_0\)</span>), we have: <span class="math">\begin{equation}
c_{\text{TMF}}(t) = \frac{m(t)}{V_0}
\end{equation}</span></p>
<p>Therefore, if we divide the latter equation by <span class="math notranslate nohighlight">\(V_0\)</span>, we have: <span class="math">\begin{equation}
\frac{c_{\text{TMF}}(t + \Delta t)-c_{\text{TMF}}(t)}{\Delta t} =  \frac{Q_{\text{pit}}  c_{\text{pit}} + Q_{\text{mill}}  c_{\text{mill}} + A_{\text{bottom}} k \left( c_{\text{pore}} - c_{\text{TMF}}  \right)    -Q_{\text{dis}} c_{\text{TMF}}}{V_0}
\end{equation}</span></p>
<p>So, after each time step, we can compute the evolution of <span class="math notranslate nohighlight">\(c_{\text{TMF}}\)</span>. How should we choose the timestep?</p>
<ol class="arabic simple">
<li><p>It is irrelevant</p></li>
<li><p>It should be as small as possible</p></li>
<li><p>The bigger the faster</p></li>
</ol>
<p>The choice of the timestep matters. Look at the previous equation:</p>
<p><span class="math">\begin{equation}
\frac{\color{blue}{c_{\text{TMF}}}(t + \Delta t)-c_{\text{TMF}}(t)}{\Delta t} =  \frac{Q_{\text{pit}}  c_{\text{pit}} + Q_{\text{mill}}  c_{\text{mill}} + A_{\text{bottom}} k \left( c_{\text{pore}} - {\color{red}{c_{\text{TMF}}}}  \right)    -Q_{\text{dis}} \color{red}{c_{\text{TMF}}}}{V_0}
\end{equation}</span></p>
<p>To compute the solution <span class="math notranslate nohighlight">\(c_{\text{TMF}}(t+ \Delta t)\)</span>, we use the value of <span class="math notranslate nohighlight">\(c_{\text{TMF}}\)</span>. But, at what time? Intrinsically, at every time between <span class="math notranslate nohighlight">\(t\)</span> and $ t + <span class="math">\Delta `t$, the value of :math:`c_{\text{TMF}}</span> changes.</p>
<p>So the timestep should be small!</p>
</div>
<div class="section" id="ODE">
<h4>ODE<a class="headerlink" href="#ODE" title="Permalink to this headline">¶</a></h4>
<p>Going to the limit <span class="math notranslate nohighlight">\(\Delta t \rightarrow 0\)</span> (i.e. <span class="math notranslate nohighlight">\(\Delta t= dt\)</span>, <span class="math notranslate nohighlight">\(c(t+\Delta t)-c(t)= dc\)</span>), the equation becomes: <span class="math">\begin{equation}
\frac{dc_{\text{TMF}}}{dt} =  \frac{Q_{\text{pit}}  c_{\text{pit}} + Q_{\text{mill}}  c_{\text{mill}} + A_{\text{bottom}} k \left( c_{\text{pore}} - c_{\text{TMF}}  \right)    -Q_{\text{dis}} c_{\text{TMF}}}{V_0}
\end{equation}</span> which is a 1<span class="math notranslate nohighlight">\(^{st}\)</span> order linear ODE.</p>
</div>
<div class="section" id="Asymptotic-behavior">
<h4>Asymptotic behavior<a class="headerlink" href="#Asymptotic-behavior" title="Permalink to this headline">¶</a></h4>
<p>Let us build a bit of physical sense is often a good idea. One should realize that this problem is bound to have a steady solution (a solution which does not evolve in time). This is not always true. But, in this case, at some point, the concentration in the TMF will be so that the sink term will exactly compensate the source terms.</p>
<p>This happens when the derivative is zero!</p>
<p><span class="math">\begin{equation}
\begin{array}{lll}
& \frac{dc_{\text{TMF}}}{dt} & =  & 0  \\
\Longleftrightarrow & 0 & = &  \frac{Q_{\text{pit}}  c_{\text{pit}} + Q_{\text{mill}}  c_{\text{mill}} + A_{\text{bottom}} k \left( c_{\text{pore}} - c_{\text{TMF}}  \right)    -Q_{\text{dis}} c_{\text{TMF}}}{V_0} \\
\Longleftrightarrow & c_{\text{TMF}} & = & \frac{Q_{\text{pit}}  c_{\text{pit}} + Q_{\text{mill}}  c_{\text{mill}} + kA c_{\text{pore}} }{Q_{\text{dis}}+kA} \equiv c_\infty
\end{array}
\end{equation}</span></p>
<p>The asymptotic/final concentration (the steady-state concentration) <span class="math notranslate nohighlight">\(c_\infty\)</span> corresponds to the final solution.</p>
<p>Can you try to guess which values <span class="math notranslate nohighlight">\(c_\infty\)</span> could be?</p>
<p>Let us analyse this by investigating limit cases:</p>
<ol class="arabic">
<li><p>Very fast production from the porewater: <span class="math notranslate nohighlight">\(k \rightarrow \infty\)</span> :nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>begin{equation}
begin{array}{lll}
<a href="#id9"><span class="problematic" id="id10">c_</span></a>infty &amp; = &amp; frac{Q_{text{pit}}  c_{text{pit}} + Q_{text{mill}}  c_{text{mill}} + kA c_{text{pore}} }{Q_{text{dis}}+kA} \</p>
<blockquote>
<div><dl class="simple">
<dt>&amp; = &amp; frac{color{blue}{Q_{text{pit}}  c_{text{pit}}} + color{blue}{Q_{text{mill}}  c_{text{mill}}} + kA c_{text{pore}} }{color{blue}{Q_{text{dis}}}+kA} \</dt><dd><p>&amp; approx &amp; frac{kA c_{text{pore}} }{kA} \</p>
</dd>
</dl>
<p>&amp; approx &amp; c_{text{pore}} = 2000 text{ mg/L}</p>
</div></blockquote>
<p>end{array}
end{equation}`</p>
</li>
<li><p>Very slow production from the porewater: <span class="math notranslate nohighlight">\(k \rightarrow 0\)</span> :nbsphinx-math:<a href="#id3"><span class="problematic" id="id4">`</span></a>begin{equation}
begin{array}{lll}
<a href="#id11"><span class="problematic" id="id12">c_</span></a>infty &amp; = &amp; frac{Q_{text{pit}}  c_{text{pit}} + Q_{text{mill}}  c_{text{mill}} + kA c_{text{pore}} }{Q_{text{dis}}+kA} \</p>
<blockquote>
<div><dl class="simple">
<dt>&amp; = &amp; frac{Q_{text{pit}}  c_{text{pit}} + Q_{text{mill}}  c_{text{mill}} + color{blue}{kA c_{text{pore}}} }{Q_{text{dis}}+color{blue}{kA}} \</dt><dd><p>&amp; approx &amp; frac{Q_{text{pit}}  c_{text{pit}} + Q_{text{mill}}  c_{text{mill}}}{Q_{text{dis}}} \</p>
</dd>
</dl>
<p>&amp; approx &amp; 256.82 text{ mg/L}</p>
</div></blockquote>
<p>end{array}
end{equation}`</p>
</li>
</ol>
<p>Therefore, the asymptotic concentration should never be outside these two bounds!</p>
</div>
</div>
<div class="section" id="Analytical-Solution">
<h3>Analytical Solution<a class="headerlink" href="#Analytical-Solution" title="Permalink to this headline">¶</a></h3>
<p>The ODE can be rewritten in the following way:</p>
<p><span class="math">\begin{equation}
\frac{dc_{\text{TMF}}}{dt} + \lambda c_{\text{TMF}} = Q
\end{equation}</span> with <span class="math">\begin{equation}
\left\lbrace
\begin{array}{lll}
Q & = & \frac{Q_{\text{pit}}c_{\text{pit}} + Q_{\text{mill}}c_{\text{mill}}+ kAc_{\text{pore}}}{V_0} \\
\lambda & = & \frac{Q_{\text{dis}}+kA}{V_0}
\end{array}
\right.
\end{equation}</span></p>
<p>You can notice that <span class="math">\begin{equation}
c_\infty = \frac{Q}{\lambda}
\end{equation}</span></p>
<p>The associated homogeneous problem is <span class="math">\begin{equation}
\begin{array}{ll}
& \frac{dc_{\text{TMF}}}{dt} + \lambda c_{\text{TMF}} = 0 \\
\Longleftrightarrow & \frac{dc_{\text{TMF}}}{dt}   = -\lambda c_{\text{TMF}} \\
\end{array}
\end{equation}</span></p>
<p>In other words, we are trying to find a function which is proportional to its opposite.</p>
<p>Any idea?</p>
<p>The solution of the homogeneous problem <span class="math notranslate nohighlight">\(c_H\)</span> is <span class="math">\begin{equation}
c_H(t) = A \mathrm{exp}(-\lambda t)
\end{equation}</span></p>
<p>The solution to the particular problem should arise from our physical sense. We know that the solution should reach a steady-state, so a particular solution is a constant solution <span class="math notranslate nohighlight">\(c_p(t) = c\)</span>.</p>
<p>By injecting that solution into the differential problem, we find:</p>
<p><span class="math">\begin{equation}
c_p(t) = c = \frac{Q}{\lambda} = c_\infty
\end{equation}</span></p>
<p>which corresponds to our physical sense!</p>
<p>So that the general solution to the ODE is: <span class="math">\begin{equation}
c_{\text{TMF}}(t) = c_\infty + A \mathrm{exp}(-\lambda t)
\end{equation}</span></p>
<p>The last thing to do is to find the value of A so that the initial concentration meets our given problem. Usually, initial means at <span class="math notranslate nohighlight">\(t=0\)</span>, but you can take any other value of time <span class="math notranslate nohighlight">\(t_0\)</span>, as long as you are consistent with that value later.</p>
<p>We know that: <span class="math">\begin{equation}
c(0) = c_0 (=93) \Longleftrightarrow c_\infty + A = c_0 \Longleftrightarrow A = c_0 - c_\infty
\end{equation}</span></p>
<p>So the exact solution of the problem: <span class="math">\begin{equation}
c_{\text{TMF}}(t) = c_\infty + \left( c_0 - c_\infty \right) \mathrm{exp}(-\lambda t)
\end{equation}</span></p>
<p>So, what would happen if you arbitrarly chose <span class="math notranslate nohighlight">\(t_0\)</span> to be something else than 0? For example, if you want <span class="math notranslate nohighlight">\(t_0\)</span> to be the age of the universe, then, <span class="math notranslate nohighlight">\(c_{\text{TMF}}\)</span> has to match 93 mg/L after 4.343 <span class="math notranslate nohighlight">\(\times\)</span> 10<span class="math notranslate nohighlight">\(^{17}\)</span>seconds (13.772 billions of years!). That would give you a value A. As long as you stick to that value of A and to that initial <span class="math notranslate nohighlight">\(t_0\)</span>, the following solution will be the same. But computationnally, the difference between 13 billions of years
and 13 billions + 1 year might be lost in rounding erros… So it’s probably not the greatest idea!</p>
<p>The fact that we know the exact solution to a problem allows us to assess the accuracy of a computational approach. Let us take a look at the solution!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Parameters definition</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">c_pit</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">c_pore</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">c_mill</span> <span class="o">=</span> <span class="mi">700</span>
<span class="n">Q_pit</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">Q_mill</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">Q_dis</span> <span class="o">=</span> <span class="mi">44</span>
<span class="n">V0</span> <span class="o">=</span> <span class="mf">8.1e9</span>
<span class="n">c0</span> <span class="o">=</span> <span class="mi">93</span>  <span class="c1"># initial concentration</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">2.5e-5</span>
<span class="n">Area</span> <span class="o">=</span> <span class="mf">3e5</span>
<span class="c1">#</span>
<span class="c1"># Eqn 13</span>
<span class="c1">#</span>
<span class="n">c_inf</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q_pit</span> <span class="o">*</span> <span class="n">c_pit</span> <span class="o">+</span> <span class="n">Q_mill</span> <span class="o">*</span> <span class="n">c_mill</span> <span class="o">+</span> <span class="n">Area</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">c_pore</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">Q_dis</span> <span class="o">+</span> <span class="n">Area</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">c0</span> <span class="o">-</span> <span class="n">c_inf</span>
<span class="n">lam</span> <span class="o">=</span> <span class="p">(</span><span class="n">Area</span> <span class="o">*</span> <span class="n">k</span> <span class="o">+</span> <span class="n">Q_dis</span><span class="p">)</span> <span class="o">/</span> <span class="n">V0</span>  <span class="c1"># units are here in s^{-1}</span>
<span class="c1">#</span>
<span class="c1"># Eqn 15</span>
<span class="c1">#</span>
<span class="n">Q</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q_pit</span> <span class="o">*</span> <span class="n">c_pit</span> <span class="o">+</span> <span class="n">Q_mill</span> <span class="o">*</span> <span class="n">c_mill</span> <span class="o">+</span> <span class="n">Area</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">c_pore</span><span class="p">)</span> <span class="o">/</span> <span class="n">V0</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
6.358024691358025e-09
3.2469135802469134e-06
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># This is the routine to plot the exact solution for the concentration at every day</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># day</span>
<span class="n">Tf</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># years</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">365</span> <span class="o">*</span> <span class="n">Tf</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>  <span class="c1"># int() is to convert thhe result into an integer</span>
<span class="n">c_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
    <span class="n">n</span><span class="p">,</span> <span class="nb">float</span>
<span class="p">)</span>  <span class="c1"># represents the concentration of sultates (mg/L) at each time</span>
<span class="n">timeY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>  <span class="c1"># time in years</span>
<span class="n">c_real</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span>
<span class="n">c_asymptotic</span> <span class="o">=</span> <span class="n">c_inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="n">n</span><span class="p">,</span> <span class="nb">float</span>
<span class="p">)</span>  <span class="c1"># this is an array of size n, whose values are all c_inf</span>

<span class="c1">#</span>
<span class="c1"># Eq. 22</span>
<span class="c1">#</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">timeY</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="mi">365</span>
    <span class="n">c_real</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_inf</span> <span class="o">+</span> <span class="p">(</span><span class="n">c0</span> <span class="o">-</span> <span class="n">c_inf</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">lam</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="n">c_real</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real Concentration&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="n">c_asymptotic</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Asymptotic value&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (years)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Concentration (mg/L)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Asymptotic concentration is: </span><span class="si">{</span><span class="n">c_inf</span><span class="si">}</span><span class="s2"> mg/L,</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;exact concentration after </span><span class="si">{</span><span class="n">Tf</span><span class="si">}</span><span class="s2"> years is </span><span class="si">{</span><span class="n">c_real</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Asymptotic concentration is: 510.6796116504854 mg/L,
exact concentration after 50 years is 510.6611233781182
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_Lec5_Euler_12_1.png" src="../_images/web_notebooks_Lec5_Euler_12_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Integral-form-of-the-ODE">
<h2>Integral form of the ODE<a class="headerlink" href="#Integral-form-of-the-ODE" title="Permalink to this headline">¶</a></h2>
<p>The general 1<span class="math notranslate nohighlight">\(^{st}\)</span> order ODE is written in the form</p>
<p><span class="math">\begin{equation}
\frac{dy}{dt} = f(y,t) \Longleftrightarrow dy = f(y,t)dt
\end{equation}</span></p>
<p>If the ODE is not separable (meaning the function <span class="math notranslate nohighlight">\(f(y,t)\)</span> cannot be split into function <span class="math notranslate nohighlight">\(f(y,t)=Y(y)T(t)\)</span>, we cannot apply the variable separation method.</p>
<p>We can therefore write: <span class="math">\begin{equation}
\int dy = \int_{t_0}^{t_0+\Delta t} f(y,t)dt
\end{equation}</span></p>
<p>which leads to</p>
<p><span class="math">\begin{equation}
y(t_0+\Delta t) =  y(t_0) + \int_{t_0}^{t_0+\Delta t} f(y,t)dt
\end{equation}</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;figures/figinit.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_Lec5_Euler_14_0.png" src="../_images/web_notebooks_Lec5_Euler_14_0.png" />
</div>
</div>
<div class="section" id="Euler’s-approach">
<h3>Euler’s approach<a class="headerlink" href="#Euler’s-approach" title="Permalink to this headline">¶</a></h3>
<p>The two Euler’s methods are a way to compute this integral term. They both work on the approximation that the function <span class="math notranslate nohighlight">\(f(y,t)\)</span> is constant over the timestep [<span class="math notranslate nohighlight">\(t\)</span>;<span class="math notranslate nohighlight">\(t+\Delta t\)</span>].</p>
<div class="section" id="Forward-Euler">
<h4>Forward Euler<a class="headerlink" href="#Forward-Euler" title="Permalink to this headline">¶</a></h4>
<p>The forward Euler approach consists in the following approximation:</p>
<p><span class="math">\begin{equation}
f(y,t) \approx f(y_0,t_0) \text{  between [$t_0$;$t_0+\Delta t$]}
\end{equation}</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;figures/figExplicitEuler.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_Lec5_Euler_16_0.png" src="../_images/web_notebooks_Lec5_Euler_16_0.png" />
</div>
</div>
<p>This approximation allows us to write:</p>
<p><span class="math">\begin{equation}
\begin{array}{lll}
\int_{t_0}^{t_0 + \Delta t} f(y,t)dt & \approx & f(y_0,t_0) \int_{t_0}^{t_0 + \Delta t} dt \\
& \approx & f(y,t_0) \Delta t
\end{array}
\end{equation}</span></p>
<p>The forward Euler method takes the solution at time <span class="math notranslate nohighlight">\(t_n\)</span> and advances it to time <span class="math notranslate nohighlight">\(t_{n+1}\)</span> using the value of the derivative <span class="math notranslate nohighlight">\(f(y_n,t_n)\)</span> at time <span class="math notranslate nohighlight">\(t_n\)</span></p>
<div class="math notranslate nohighlight">
\[y(t_0+\Delta t) = y(t_0) + \Delta t f(y(t_0),t_0)\]</div>
<p>This is also referred to as the explicit approach, as the new value of function <span class="math notranslate nohighlight">\(y\)</span> can be computed immediately (i.e. explicitly) from the previous expression.</p>
</div>
<div class="section" id="Backward-Euler">
<h4>Backward Euler<a class="headerlink" href="#Backward-Euler" title="Permalink to this headline">¶</a></h4>
<p>The backward Euler method is very similar in principle but its application leads to very different results (forward approach is almost never used for stability issues, see below). The forward Euler approach consists in the following approximation:</p>
<p><span class="math">\begin{equation}
f(y,t) \approx f(y,t_0+\Delta t) \text{  between [$t_0$;$t_0+\Delta t$]}
\end{equation}</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;figures/figImplicitEuler.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_Lec5_Euler_19_0.png" src="../_images/web_notebooks_Lec5_Euler_19_0.png" />
</div>
</div>
<p>This approximation allows us to write:</p>
<p><span class="math">\begin{equation}
\begin{array}{lll}
\int_{t_0}^{t_0 + \Delta t} f(y,t)dt & \approx & f(y,t_0+\Delta t) \int_{t_0}^{t_0 + \Delta t} dt \\
& \approx & f(y,t_0+\Delta t) \Delta t
\end{array}
\end{equation}</span></p>
<p>Back in the initial ODE, this yields: <span class="math">\begin{equation}
y(t_0+\Delta t) =  y(t_0) + f(y,t_0+\Delta t) \Delta t
\end{equation}</span></p>
<p>Which is an equation which has to be solved. Depending on the form of the function <span class="math notranslate nohighlight">\(f\)</span>, this might be a nonlinear equation to solve. We will see later examples of methods to solve these problems (Newton method, for example).</p>
</div>
</div>
<div class="section" id="Examples-of-application">
<h3>Examples of application<a class="headerlink" href="#Examples-of-application" title="Permalink to this headline">¶</a></h3>
<p>We have shown that the associated ODE to the sulate problem could be written as:</p>
<p><span class="math">\begin{equation}
\frac{dc_{\text{TMF}}}{dt} + \lambda c_{\text{TMF}} = Q
\end{equation}</span> with <span class="math">\begin{equation}
\left\lbrace
\begin{array}{lllll}
Q & = & \frac{Q_{\text{pit}}c_{\text{pit}} + Q_{\text{mill}}c_{\text{mill}}+ kAc_{\text{pore}}}{V_0} & \approx & 3.247 \times 10^{-6} mg . L^{-1} . s^{-1} \\
\lambda & = & \frac{Q_{\text{dis}}+kA}{V_0} & \approx & 6.358 \times 10^{-9} s^{-1}
\end{array}
\right.
\end{equation}</span></p>
<p>The forward Euler’s method yields: <span class="math">\begin{equation}
c(t_0 + \Delta t) = c(t_0) +  \left( Q - \lambda c(t_0) \right) \Delta t
\end{equation}</span></p>
<p>While the backward Euler’s method yields: <span class="math">\begin{equation}
\begin{array}{llll}
& c(t_0 + \Delta t) & = &  c(t_0) + \Delta t (Q - \lambda c(t_0+\Delta t)) \\
\Longleftrightarrow & c(t_0 + \Delta t) \left( 1 + \lambda \Delta t \right) & = & c(t_0) + Q \Delta t \\
\Longleftrightarrow & c(t_0 + \Delta t)  & = & \displaystyle{\frac{c(t_0) + Q \Delta t}{1 + \lambda \Delta t}} \\
\end{array}
\end{equation}</span></p>
<p>So, let us compare these solutions to the analytical solution. We will therefore compute the two Euler approaches at each timestep and assess the error of the solution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># This is the routine to plot the exact solution for the concentration at every day</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># day</span>
<span class="n">Tf</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># years</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">365</span> <span class="o">*</span> <span class="n">Tf</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>  <span class="c1"># int() is to convert thhe result into an integer</span>
<span class="n">c_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
    <span class="n">n</span><span class="p">,</span> <span class="nb">float</span>
<span class="p">)</span>  <span class="c1"># represents the concentration of sultates (mg/L) at each time</span>
<span class="n">timeY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>  <span class="c1"># time in years</span>
<span class="n">c_real</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span>
<span class="n">c_asymptotic</span> <span class="o">=</span> <span class="n">c_inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="n">n</span><span class="p">,</span> <span class="nb">float</span>
<span class="p">)</span>  <span class="c1"># this is an array of size n full, whose values are all c_inf</span>
<span class="n">Forward_Euler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">Backward_Euler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">err_Backward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">err_Forward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">Forward_Euler</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span>
<span class="n">Backward_Euler</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">timeY</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="mi">365</span>
    <span class="n">c_real</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_inf</span> <span class="o">+</span> <span class="p">(</span><span class="n">c0</span> <span class="o">-</span> <span class="n">c_inf</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">lam</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span>
    <span class="n">Forward_Euler</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#ADAPT THIS</span>
    <span class="n">Backward_Euler</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="c1"># ADAPT THIS</span>
    <span class="n">err_Backward</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">c_real</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Backward_Euler</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">c_real</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">err_Forward</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Forward_Euler</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">c_real</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">c_real</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="n">c_real</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real Concentration&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="n">Forward_Euler</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Concentration - Forward Euler&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="n">Backward_Euler</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Concentration - Backward Euler&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (years)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Concentration (mg/L)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">err_Backward</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Error - backward Euler&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">err_Forward</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Error - forward Euler&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (years)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Error (%)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7f1d93db0a90&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_Lec5_Euler_22_1.png" src="../_images/web_notebooks_Lec5_Euler_22_1.png" />
</div>
</div>
<p>We can see that the two approaches are quite close to each other and to the analytical solution. This means that the approximation is good. When you calculated the sulfates concentration after 1 day, you saw that it had increased from 93 to 93.23 mg/L, hence a relative increase of 0.2%. This yields that the approximation that <span class="math notranslate nohighlight">\(c_{\text{TMF}}\)</span> is constant over a day is pretty good, hence a relatively small error!</p>
<p>So, the bigger the timestep, the less accurate is the approximation. Let us check that! We will set a timestep of 5 years and see the effect on the result and the error.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dt</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">365</span>  <span class="c1"># day</span>
<span class="n">Tf</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># years</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">365</span> <span class="o">*</span> <span class="n">Tf</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>  <span class="c1"># int() is to convert thhe result into an integer</span>

<span class="n">timeY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Tf</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># this is a way to create an array of size n,</span>
<span class="c1"># which starts at 0, ends at Tf and every elements</span>
<span class="c1"># are evenly spaced</span>
<span class="n">c_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
    <span class="n">n</span><span class="p">,</span> <span class="nb">float</span>
<span class="p">)</span>  <span class="c1"># represents the concentration of sultates (mg/L) at each time</span>
<span class="c1"># timeY             = np.zeros(n, float) # time in years</span>
<span class="n">c_real</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span>
<span class="n">c_asymptotic</span> <span class="o">=</span> <span class="n">c_inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
    <span class="n">n</span><span class="p">,</span> <span class="nb">float</span>
<span class="p">)</span>  <span class="c1"># this is an array of size n full, whose values are all c_inf</span>
<span class="n">Forward_Euler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">Backward_Euler</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">err_Backward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">err_Forward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
<span class="n">Forward_Euler</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span>
<span class="n">Backward_Euler</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># timeY[i+1]          = (i+1)*dt/365</span>
    <span class="n">c_real</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_inf</span> <span class="o">+</span> <span class="p">(</span><span class="n">c0</span> <span class="o">-</span> <span class="n">c_inf</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">lam</span> <span class="o">*</span> <span class="n">timeY</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">365</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span>
    <span class="n">Forward_Euler</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Backward_Euler</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">err_Backward</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">err_Forward</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="n">c_real</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Real Concentration&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="n">Forward_Euler</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Concentration - Forward Euler&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="n">Backward_Euler</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Concentration - Backward Euler&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (years)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Concentration (mg/L)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">err_Backward</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Error - backward Euler&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeY</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">err_Forward</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Error - forkward Euler&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time (years)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Error (%)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7f1d93a3cac8&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_Lec5_Euler_24_1.png" src="../_images/web_notebooks_Lec5_Euler_24_1.png" />
</div>
</div>
<p>This defines the accuracy of the algorithm. The accuracy decreases when the timestep increases!</p>
<p>Basically, Euler’s method states that here, for the first 5 years, the source term from the tailings porewater is at its maximum, and the discharge is at its minimum for the forward Euler’s approach. We therefore have a very important overestimation of the source and underestimation of the sink, which yields an important overestimation of the error.</p>
<p>Now, do the same with an even bigger timestep (25 years and see what is happening over a longer timescale, like 250 years).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">### YOUR CODE HERE</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7f1d93c073c8&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_Lec5_Euler_26_1.png" src="../_images/web_notebooks_Lec5_Euler_26_1.png" />
</div>
</div>
<p>This defines the concept of stability.</p>
<p>We can show that Euler’s backward method is unconditionnally stable (for every timestep), while Euler’s forward (explicit) method has a restrictive timestep condition for stability.</p>
<p>That is one of the reason why Euler’s backward (implicit) method is usually preferred than the Euler’s forward (explicit approach). However, this yields 1. In most case (depending on <span class="math notranslate nohighlight">\(f(y,t)\)</span>), there is an equation to solve (often numerically) to find the value of <span class="math notranslate nohighlight">\(y(t+\Delta t)\)</span> 2. Stability does not mean accuracy</p>
<p>These methods are referred to as 1<span class="math notranslate nohighlight">\(^{st}\)</span> order methods. The order of the method is linked to the Taylor approximation</p>
<p><span class="math">\begin{equation}
y(t+\Delta t) = y(t) + (\Delta t) y^\prime(t) +   \frac{1}{2}(\Delta t)^2 y^{\prime\prime}(t) +\cdots
\end{equation}</span></p>
<p>So, as the function f is the derivative of <span class="math notranslate nohighlight">\(y\)</span>, the Euler’s approach omits all the term but the 1<span class="math notranslate nohighlight">\(^{st}\)</span> order: it is called a first order method (also we use <span class="math notranslate nohighlight">\(y = y_0 + \Delta t f\)</span>). We compute the evolution of the solution based on the first order approximation of <span class="math notranslate nohighlight">\(y\)</span> (we assume a constant value for its derivative <span class="math notranslate nohighlight">\(f\)</span>).</p>
<p>The truncation error corresponds to the omission of all the higher order terms:</p>
<p><span class="math">\begin{equation}
\text{Truncation error } = \frac{1}{2}(\Delta t)^2 y^{\prime\prime}(t) +\cdots
\end{equation}</span></p>
<p>So, the intrinsic error we make with Euler’s methods is proportional to <span class="math notranslate nohighlight">\((\Delta t)^2\)</span>. In words, we say that forward Euler is first order accurate with errors of second order. It is therefore clear that reducing the timestep reduces the errors.</p>
</div>
<div class="section" id="Runge-Kutta-methods">
<h3>Runge Kutta methods<a class="headerlink" href="#Runge-Kutta-methods" title="Permalink to this headline">¶</a></h3>
<p>In a lot of applications, Euler’s implicit method is used. But in some cases, higher order and more accurate methods need to be used. They basically compute the integral</p>
<div class="math notranslate nohighlight">
\[y(t_0+\Delta t) = y(t_0) + \int_{t_0}^{t_0+\Delta t} f(t,y) dt\]</div>
<p>with more accuracy (with a higher-order). These are commonly known as the Runge-Kutta methods (Euler’s methods are a 1st order Runge-Kutta method). The idea of the Runge-Kutta schemes is to take advantage of derivative information at the times between <span class="math notranslate nohighlight">\(t_n\)</span> and <span class="math notranslate nohighlight">\(t_{n+1}\)</span> to increase the order of accuracy.</p>
<p>For example, in the midpoint method, the derivative at the initial time is used to approximate the derivative at the midpoint of the interval, <span class="math notranslate nohighlight">\(f(y_n+\frac{1}{2}hf(y_n,t_n), t_n+\frac{1}{2}h)\)</span>. The derivative at the midpoint is then used to advance the solution to the next step. The method can be written in two <em>stages</em> <span class="math notranslate nohighlight">\(k_i\)</span>,</p>
<dl>
<dt>:nbsphinx-math:<a href="#id5"><span class="problematic" id="id6">`</span></a>begin{equation}</dt><dd><blockquote>
<div><dl class="simple">
<dt>begin{array}{lll}</dt><dd><p>k_1 &amp; = &amp;  Delta t f(y(t),t)\
k_2 &amp; =&amp;  Delta t , fleft( y(t)+frac{1}{2}k_1, t+frac{1}{2}Delta t right)\y(t+Delta t) &amp; =&amp;  y(t) + k_2</p>
</dd>
</dl>
</div></blockquote>
<p>end{array}</p>
</dd>
</dl>
<p>end{equation}`</p>
<p>The midpoint method is known as a 2-stage Runge-Kutta formula.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;figures/figMidpoint.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_Lec5_Euler_29_0.png" src="../_images/web_notebooks_Lec5_Euler_29_0.png" />
</div>
</div>
<p>In general, an <em>explicit</em> 2-stage Runge-Kutta method can be written as,</p>
<dl>
<dt>:nbsphinx-math:<a href="#id7"><span class="problematic" id="id8">`</span></a>begin{equation}</dt><dd><blockquote>
<div><dl class="simple">
<dt>begin{array}{l}</dt><dd><p>k_1 =  h f(y(t),t)\
k_2 = Delta t f left( y(t)+b_{21}k_1, t+a_2h right) \
y(t+Delta t) = y(t) + c_1k_1 +c_2k_2</p>
</dd>
</dl>
</div></blockquote>
<p>end{array}</p>
</dd>
</dl>
<p>end{equation}`</p>
<p>It is said explicit because the new solution only depends on the previous solution. The different coefficient can be determined by comparison with the 2<span class="math notranslate nohighlight">\(^{nd}\)</span> order Taylor approximation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;figures/fig-Summary.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_Lec5_Euler_31_0.png" src="../_images/web_notebooks_Lec5_Euler_31_0.png" />
</div>
</div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    <footer class="footer">
  <div class="container">
    <p>
          &copy; Copyright Numeric project.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>