

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>2D Transient simulation &#8212; Numeric course 0.1 documentation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link href="../_static/css/index.css" rel="stylesheet">
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">

<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
</button>

<div id="navbar-menu" class="collapse navbar-collapse">
  <ul id="navbar-main-elements" class="navbar-nav mr-auto">
    <li class="nav-item">
        <a class="nav-link" href="../index.html">Home</a>
    </li>
    
    
    <li class="nav-item ">
        <a class="nav-link" href="../learning_goals/learning_goals.html">Learning goals</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../week_notes.html">Weekly notes</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../solutions.html">Assignment solutions</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../texts.html">Texts</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../getting_started.html">Python</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../cheat_sheet.html">Cheat sheet</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../notebook_index.html">Notebook index</a>
    </li>
    
    
  </ul>
  <ul class="navbar-nav ml-auto">
    
    
  </ul>
</div>
    </nav>
    

    <div class="container-fluid">
      <div class="row">
          
          <div class="col-12 col-md-3 col-xl-2 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              


<div class="tocsection onthispage"><i class="fas fa-list"></i> On this page</div>
<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Learning-Goals" class="nav-link">Learning Goals</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Context" class="nav-link">Context</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Boundary-conditions" class="nav-link">Boundary conditions</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Transient-diffusion-from-a-constant-concentration-boundary" class="nav-link">Transient diffusion from a constant-concentration boundary</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#1D-Homogeneous-problem" class="nav-link">1D Homogeneous problem</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Now-solve-the-1D-problem" class="nav-link">Now solve the 1D problem</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#Quantification-of-the-error" class="nav-link">Quantification of the error</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#Q1-(5)-–-calculate-an-error-function" class="nav-link">Q1 (5) – calculate an error function</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#Q2-(5)-Plot-the-error-and-execution-time" class="nav-link">Q2 (5) Plot the error and execution time</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#Q3-(3)-Find-the-“sweet-spot”" class="nav-link">Q3 (3) Find the “sweet spot”</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#2D-transient-diffusion-in-homogeneous-media" class="nav-link">2D transient diffusion in homogeneous media</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#Q4-(2)-Comment-on-the-steady-state-solution" class="nav-link">Q4 (2) Comment on the steady state solution</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#Q5-(10)-Solve-for-the-2D-concentration-as-a-function-of-time" class="nav-link">Q5 (10) Solve for the 2D concentration as a function of time</a>
        </li>
    
            </ul>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Conclusions" class="nav-link">Conclusions</a>
        </li>
    
    </ul>
</nav>
              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<h1><p>Table of Contents</p>
</h1><div class="toc"><ul class="toc-item"><li><p>1  Learning Goals</p>
</li><li><p>2  Context</p>
</li><li><p>3  Boundary conditions</p>
</li><li><p>4  Transient diffusion from a constant-concentration boundary</p>
<ul class="toc-item"><li><p>4.1  1D Homogeneous problem</p>
</li><li><p>4.2  Now solve the 1D problem</p>
</li><li><p>4.3  Quantification of the error</p>
<ul class="toc-item"><li><p>4.3.1  Q1 (5) – calculate an error function</p>
</li><li><p>4.3.2  Q2 (5) Plot the error and execution time</p>
</li><li><p>4.3.3  Q3 (3) Find the “sweet spot”</p>
</li></ul></li><li><p>4.4  2D transient diffusion in homogeneous media</p>
<ul class="toc-item"><li><p>4.4.1  Q4 (2) Comment on the steady state solution</p>
</li><li><p>4.4.2  Q5 (10) Solve for the 2D concentration as a function of time</p>
</li></ul></li></ul></li><li><p>5  Conclusions</p>
</li></ul></div><div class="section" id="2D-Transient-simulation">
<h1>2D Transient simulation<a class="headerlink" href="#2D-Transient-simulation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Learning-Goals">
<h2>Learning Goals<a class="headerlink" href="#Learning-Goals" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Formulate and solve a 2D diffusion problem with inhomogeneous diffusion</p></li>
<li><p>Assess the accuracy by comparing the solution of a homogeneous problem to an analyitical solution</p></li>
<li><p>Define the gridsize and timesteps to have reasonable computation time vs accuracy</p></li>
<li><p>Use this approach to model a more complicated problem</p></li>
<li><p>Use simple python classes to organize parameters</p></li>
</ul>
</div>
<div class="section" id="Context">
<h2>Context<a class="headerlink" href="#Context" title="Permalink to this headline">¶</a></h2>
<p>We want to study the diffusion of a contaminant in a geological context. The different geological layers and zones induce that the diffusion is not the same in every direction. We want to model these effects that diffusion is stopped on some boundary, that diffusion avoids certain areas of low diffusivity, …</p>
<p>To start that, we need a transient 2D model whose parameters are well defined. In order to assess the accuracy of the method, we will start by using the approach on simple cases for which an analytical solution is known. That will allow to define the timestep, gridsize, to have a reasonable agreement with analytical solution.</p>
<p>From then, we will be able to model any similar situation.</p>
</div>
<div class="section" id="Boundary-conditions">
<h2>Boundary conditions<a class="headerlink" href="#Boundary-conditions" title="Permalink to this headline">¶</a></h2>
<p>Different types of boundary conditions can be encountered. So far, we have only used a boundary condition specifying the value of the unknown at one point (these are called Dirichlet boundary condition). In some case, a flux is specified as a boundary condition, e.g. a certain amount of water/gas is injected at one boundary at a rate of 1 kg/s. These conditions will specify the derivative of the unknowns.</p>
<p>A usual boundary condition is a no-flux boundary condition, meaning the solutes cannot go through a boundary. No diffusive flux means that the difference in concentration is zero. Thus, it specifies a zero-derivative at the boundary. Physically, this represents particle bouncing on a reflecting surface: every particle colliding with the surface is reflected back. Therefore, zooming on the boundary, the derivative of the concentration is zero.</p>
</div>
<div class="section" id="Transient-diffusion-from-a-constant-concentration-boundary">
<h2>Transient diffusion from a constant-concentration boundary<a class="headerlink" href="#Transient-diffusion-from-a-constant-concentration-boundary" title="Permalink to this headline">¶</a></h2>
<p>Let us describe the diffusion of a contaminant with concentration c in soils where a constant concentration <span class="math notranslate nohighlight">\(c_0\)</span> is fixed at one boundary. It can be shown that the analytical solution to such a problem can be represented by the following equation:</p>
<p><span class="math">\begin{equation}
c(x,t) = c_0  \text{erfc}\left( \frac{x}{\sqrt{4Dt}}  \right)
\end{equation}</span></p>
<p>where erfc<span class="math notranslate nohighlight">\((x)\)</span> is the error function, t is time ad D is the diffusivity. Let us look at this solution for different timesteps.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cmap</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">AxesGrid</span>
<span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="kn">import</span> <span class="n">assert_allclose</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">special</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n_tstep</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">Days_of_Plot</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>

<span class="n">n_x</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># number of cells</span>
<span class="n">width</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># dm</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">n_x</span><span class="p">)</span>
<span class="n">analytic_conc_1D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_tstep</span><span class="p">,</span> <span class="n">n_x</span><span class="p">))</span>
<span class="n">c0</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># mg/L</span>
<span class="n">Diff</span> <span class="o">=</span> <span class="mf">2e-9</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span>  <span class="c1"># dm²/day</span>
<span class="n">analytic_conc_1D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span>  <span class="c1"># mg/L</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">analytic_conc_1D</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Initial concentration&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_tstep</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_x</span><span class="p">):</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">Diff</span> <span class="o">*</span> <span class="n">Days_of_Plot</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
        <span class="n">analytic_conc_1D</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">erfc</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">analytic_conc_1D</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:],</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Concentration after </span><span class="si">%.0f</span><span class="s2"> days&quot;</span> <span class="o">%</span> <span class="n">Days_of_Plot</span><span class="p">[</span><span class="n">t</span><span class="p">],</span>
    <span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x-axis (dm)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Concentration (mg/L)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If we consider a 2D system, without any heterogeneity along the y-axis, the previous solution is valid for each y axis, and you can imagine that the previous plot is a transverse cross-section of the evolution of the front. This means that, whatever the value of <span class="math notranslate nohighlight">\(y\)</span>:</p>
<dl>
<dt>:nbsphinx-math:<a href="#id1"><span class="problematic" id="id2">`</span></a>begin{equation}</dt><dd><blockquote>
<div><p>c(x,y_1,t) = c(x,y_2,t) quad forall y_1,y_2,x,t</p>
</div></blockquote>
<p>end{equation}`</p>
</dd>
</dl>
<p>In the next few cells, we define some functions which we will use throughout the rest of the assignment.</p>
<ul class="simple">
<li><p>avg(Di,Dj) computes the average diffusion coefficient to compute the flux between two cells with different D</p></li>
<li><p>index_to_row_col(…), mat2vec() and vec2mat() functions to find which column and which row correspond to which linear index, and to move back and forth between the 2D array for the physical domain and the 1D vector equation system used for the linear equation solver</p></li>
<li><p>build_2D_matrix(…) is the same function than before, generalized to 2D and multiple boundary conditions</p></li>
</ul>
<p>Then we have defined two classes (objects) which will store informations to make it easier to pass to functions.</p>
<ul class="simple">
<li><p>class boundary: creates a boundary which has a type and an assigned value (“const” means constant-concentration boundary, and its attribute “val” is the value of this concentration. otherwise, it is a flux boundary condition, and the attribute “0” expresses the derivative at that boundary).</p></li>
<li><p>class Problem_Def: puts every relevant parameter in an object to be given to build_2D_matrix</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># this function deals with harmonic averaging when diffusion is not the same everywhere.</span>
<span class="c1"># It doesn&#39;t change anything when diffusion is homogeneous but you can try to see how it affects the behavior.</span>


<span class="k">def</span> <span class="nf">avg</span><span class="p">(</span><span class="n">Di</span><span class="p">,</span> <span class="n">Dj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the harmonic average between two values Di and Dj</span>
<span class="sd">    Returns 0 if either of them is zero</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Di</span> <span class="o">*</span> <span class="n">Dj</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">Di</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Dj</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">index_to_row_col</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">index_to_row_col</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">nrows</span><span class="p">,</span> <span class="n">ncol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    in a 2D array, returns the row and column value</span>
<span class="sd">    associated with a 1D index</span>
<span class="sd">    Bottom left is index is zero (0-th row, 0-th column)</span>
<span class="sd">    while index one is the 0-th row and 1st column</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ind</span> <span class="o">&gt;</span> <span class="n">nrows</span> <span class="o">*</span> <span class="n">ncol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ind</span> <span class="o">/</span> <span class="n">ncol</span><span class="p">))</span>
    <span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ind</span> <span class="o">-</span> <span class="n">row</span> <span class="o">*</span> <span class="n">ncol</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">build_2D_matrix</span><span class="p">(</span><span class="n">bc_dict</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">D_matrix</span><span class="p">,</span> <span class="n">Qsource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a coefficient matrix A and an array b corresponding to the system Ac = b</span>
<span class="sd">    This system corresponds either to a 1D or 2D problem</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bc_dict: dict</span>
<span class="sd">       dictionary with Boundary_Def objects defining the boundary conditions</span>
<span class="sd">    D_matrix: (float vector if 1D or matrix if 2D)</span>
<span class="sd">        values of the diffusion coefficient at each grid point(dm^2/day)</span>
<span class="sd">        if 2D, dimension is [problem.ny, problem.nx]</span>
<span class="sd">    width_x: (float)</span>
<span class="sd">        x-extent of the domain (dm)</span>
<span class="sd">    width_y: (float)</span>
<span class="sd">        y-extent of the domain (dm)</span>
<span class="sd">    poro (float)</span>
<span class="sd">        porosity value</span>
<span class="sd">    Qsource: (float array)</span>
<span class="sd">      volumetric source term (mg/L/day)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    the_matrix, rhs: tuple</span>
<span class="sd">       where the_matrix=A and rhs =b</span>
<span class="sd">       in the discretized diffusion problem</span>
<span class="sd">       Ax=b</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number_of_rows</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">ny</span>
    <span class="n">number_of_cols</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">nx</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">nx</span> <span class="o">*</span> <span class="n">problem</span><span class="o">.</span><span class="n">ny</span>
    <span class="n">is1D</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">number_of_rows</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">number_of_cols</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">is1D</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">number_of_cols</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">the_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="n">rhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is1D</span><span class="p">:</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">wx</span><span class="p">,</span> <span class="n">problem</span><span class="o">.</span><span class="n">wy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">ny</span><span class="p">,</span> <span class="n">problem</span><span class="o">.</span><span class="n">nx</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">coef_x</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">poro</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">dx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">wx</span> <span class="o">/</span> <span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">wy</span> <span class="o">/</span> <span class="p">(</span><span class="n">problem</span><span class="o">.</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">coef_x</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">poro</span> <span class="o">/</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">dx</span>
        <span class="n">coef_y</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">poro</span> <span class="o">/</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">dy</span>

    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is1D</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">ind</span>
            <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">index_to_row_col</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">number_of_rows</span><span class="p">,</span> <span class="n">number_of_cols</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># WEST BOUNDARY</span>
            <span class="k">if</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;west&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">btype</span> <span class="o">==</span> <span class="s2">&quot;const&quot;</span><span class="p">:</span>
                <span class="n">rhs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;west&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># flux boundary condition</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">rhs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;west&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">val</span> <span class="o">/</span> <span class="n">dx</span>

        <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="n">number_of_cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># EAST BOUNDARY</span>
            <span class="k">if</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">btype</span> <span class="o">==</span> <span class="s2">&quot;const&quot;</span><span class="p">:</span>
                <span class="n">rhs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># flux boundary condition</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">rhs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;east&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">val</span> <span class="o">/</span> <span class="n">dx</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">problem</span><span class="o">.</span><span class="n">ny</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># SOUTH BOUNDARY</span>
            <span class="k">if</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;south&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">btype</span> <span class="o">==</span> <span class="s2">&quot;const&quot;</span><span class="p">:</span>
                <span class="n">rhs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;south&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># flux boundary condition</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">number_of_cols</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">rhs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;south&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">val</span> <span class="o">/</span> <span class="n">dy</span>

        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">number_of_rows</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">problem</span><span class="o">.</span><span class="n">ny</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># NORTH BOUNDARY</span>
            <span class="k">if</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;north&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">btype</span> <span class="o">==</span> <span class="s2">&quot;const&quot;</span><span class="p">:</span>
                <span class="n">rhs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;west&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># flux boundary condition</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span> <span class="o">-</span> <span class="n">number_of_cols</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">rhs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc_dict</span><span class="p">[</span><span class="s2">&quot;north&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">val</span> <span class="o">/</span> <span class="n">dy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is1D</span><span class="p">:</span>
                <span class="n">north</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">south</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">rhs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qsource</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">east</span> <span class="o">=</span> <span class="n">coef_x</span> <span class="o">*</span> <span class="n">avg</span><span class="p">(</span><span class="n">D_matrix</span><span class="p">[</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">D_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="n">west</span> <span class="o">=</span> <span class="n">coef_x</span> <span class="o">*</span> <span class="n">avg</span><span class="p">(</span><span class="n">D_matrix</span><span class="p">[</span><span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">D_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">north</span> <span class="o">=</span> <span class="n">coef_y</span> <span class="o">*</span> <span class="n">avg</span><span class="p">(</span><span class="n">D_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">D_matrix</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="n">south</span> <span class="o">=</span> <span class="n">coef_y</span> <span class="o">*</span> <span class="n">avg</span><span class="p">(</span><span class="n">D_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">D_matrix</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="n">east</span> <span class="o">=</span> <span class="n">coef_x</span> <span class="o">*</span> <span class="n">avg</span><span class="p">(</span><span class="n">D_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">D_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">west</span> <span class="o">=</span> <span class="n">coef_x</span> <span class="o">*</span> <span class="n">avg</span><span class="p">(</span><span class="n">D_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">D_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="n">number_of_cols</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">north</span>
                <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span> <span class="o">-</span> <span class="n">number_of_cols</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">south</span>
                <span class="n">rhs</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qsource</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

            <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">east</span> <span class="o">+</span> <span class="n">west</span> <span class="o">+</span> <span class="n">north</span> <span class="o">+</span> <span class="n">south</span>
            <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">east</span>
            <span class="n">the_matrix</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span> <span class="n">ind</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">west</span>

    <span class="k">return</span> <span class="n">the_matrix</span><span class="p">,</span> <span class="n">rhs</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">Boundary_Def</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    this class holds the boundary type btype (&#39;flux&#39; or &#39;const&#39;)</span>
<span class="sd">    and the value of the boundary condition (derivitive of the concentration if &#39;flux&#39;</span>
<span class="sd">    value of the concentration if &#39;const&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">btype</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">val</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">btype</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btype</span> <span class="o">=</span> <span class="n">btype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">Problem_Def</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    this class holds the specifcation for the domain,</span>
<span class="sd">    including the value of the porosity</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nx</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ny</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">poro</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">wx</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">wy</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">poro</span><span class="p">,</span> <span class="n">wx</span><span class="p">,</span> <span class="n">wy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="n">nx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ny</span> <span class="o">=</span> <span class="n">ny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poro</span> <span class="o">=</span> <span class="n">poro</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wx</span> <span class="o">=</span> <span class="n">wx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wy</span> <span class="o">=</span> <span class="n">wy</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Here we create 4 boundaries, west has a constant concentration at c0, east has a constant boundary at 0;</span>
<span class="n">west</span> <span class="o">=</span> <span class="n">Boundary_Def</span><span class="p">(</span><span class="s2">&quot;const&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">c0</span><span class="p">)</span>
<span class="n">east</span> <span class="o">=</span> <span class="n">Boundary_Def</span><span class="p">(</span><span class="s2">&quot;const&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># For 1D problem, the used boundaries are west and east.</span>

<span class="c1"># The other south and north boundaries have a zero flux (impermeable)</span>

<span class="n">north</span> <span class="o">=</span> <span class="n">Boundary_Def</span><span class="p">(</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">south</span> <span class="o">=</span> <span class="n">Boundary_Def</span><span class="p">(</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># If  you want to change boundary conditions, to see the impact of these, we highly encourage you to do so!</span>
<span class="c1"># So we leave this cell free for you to change these boundary conditions.</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">bc_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;west&quot;</span><span class="p">:</span> <span class="n">west</span><span class="p">,</span> <span class="s2">&quot;north&quot;</span><span class="p">:</span> <span class="n">north</span><span class="p">,</span> <span class="s2">&quot;east&quot;</span><span class="p">:</span> <span class="n">east</span><span class="p">,</span> <span class="s2">&quot;south&quot;</span><span class="p">:</span> <span class="n">south</span><span class="p">}</span>
<span class="c1"># The latter array bc_dict will be sent to the different functions</span>
</pre></div>
</div>
</div>
<div class="section" id="1D-Homogeneous-problem">
<h3>1D Homogeneous problem<a class="headerlink" href="#1D-Homogeneous-problem" title="Permalink to this headline">¶</a></h3>
<p>We will use the different defined function (which also work in 1D) to assess a reasonable timestep and gridsize so that the error is acceptable.</p>
<p>We give you the resolution scheme for the 1D problem in the next cell. You will have to use that again later for the error optimization, as well as for the 2D problem.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n_x</span> <span class="o">=</span> <span class="mi">51</span>
<span class="n">n_y</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Diff</span> <span class="o">=</span> <span class="mf">2e-9</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span>  <span class="c1"># dm²/day</span>
<span class="n">width_x</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># dm</span>
<span class="n">width_y</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n_x</span> <span class="o">*</span> <span class="n">n_y</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">n_x</span><span class="p">)</span>
<span class="n">c_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_x</span><span class="p">)</span>
<span class="n">c_init</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span>
<span class="n">D_matrix</span> <span class="o">=</span> <span class="n">Diff</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">poro</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">Problem_Def</span><span class="p">(</span><span class="n">n_x</span><span class="p">,</span> <span class="n">n_y</span><span class="p">,</span> <span class="n">poro</span><span class="p">,</span> <span class="n">width_x</span><span class="p">,</span> <span class="n">width_y</span><span class="p">)</span>
<span class="n">Qsource</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">A</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">build_2D_matrix</span><span class="p">(</span><span class="n">bc_dict</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">D_matrix</span><span class="p">,</span> <span class="n">Qsource</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Now-solve-the-1D-problem">
<h3>Now solve the 1D problem<a class="headerlink" href="#Now-solve-the-1D-problem" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># days</span>
<span class="n">Adelta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">Adelta</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">poro</span> <span class="o">/</span> <span class="n">dt</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">Adelta</span>
<span class="c1"># There is no need to update A at every timestep,</span>
<span class="c1"># since the timestep and the porosity are constant.</span>

<span class="n">Bdelta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="n">Tf</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># total number of days</span>
<span class="n">nTstp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Tf</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>
<span class="n">number_of_fig</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n_of_tstep_before_fig</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nTstp</span> <span class="o">/</span> <span class="n">number_of_fig</span><span class="p">)</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(((</span><span class="n">n</span><span class="p">,</span> <span class="n">number_of_fig</span><span class="p">)))</span>
<span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(((</span><span class="n">n</span><span class="p">,</span> <span class="n">number_of_fig</span><span class="p">)))</span>
<span class="n">c</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_init</span>
<span class="n">nfig</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Time</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">c_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c_init</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Initial concentration&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">err</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Initial error&quot;</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">c_init</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTstp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">Bdelta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">poro</span> <span class="o">/</span> <span class="n">dt</span>
    <span class="n">bb</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">Bdelta</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">bb</span><span class="p">)</span>
    <span class="n">Time</span> <span class="o">=</span> <span class="n">Time</span> <span class="o">+</span> <span class="n">dt</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n_of_tstep_before_fig</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">nfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">Diff</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
            <span class="n">c_real</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span> <span class="o">*</span> <span class="n">special</span><span class="o">.</span><span class="n">erfc</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
            <span class="n">err</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">nfig</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">nfig</span><span class="p">]</span> <span class="o">-</span> <span class="n">c_real</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">[:,</span> <span class="n">nfig</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Concentration after </span><span class="si">%.0f</span><span class="s2"> day&quot;</span> <span class="o">%</span> <span class="n">Time</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">err</span><span class="p">[:,</span> <span class="n">nfig</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Error after </span><span class="si">%.0f</span><span class="s2"> day&quot;</span> <span class="o">%</span> <span class="n">Time</span><span class="p">)</span>
        <span class="n">nfig</span> <span class="o">=</span> <span class="n">nfig</span> <span class="o">+</span> <span class="mi">1</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Quantification-of-the-error">
<h3>Quantification of the error<a class="headerlink" href="#Quantification-of-the-error" title="Permalink to this headline">¶</a></h3>
<p>One may realize that the previous visualization of the error is not particularly helpful. We would like to quantify the error using only one real number, so that comparison is easier. This is the concept of the <em>norm</em>. It is defined in “numpy.linalg.norm”. The norm of a vector <span class="math notranslate nohighlight">\(\overrightarrow{x}\)</span> is usually written</p>
<p><span class="math">\begin{equation}
\lvert \lvert \overrightarrow{x}\lvert\lvert
\end{equation}</span></p>
<p>There exists many type of norm</p>
<p>Norm-1:</p>
<p><span class="math">\begin{equation}
\lvert\lvert\overrightarrow{x}\lvert\lvert_1 = \sum_i^N |x_i|
\end{equation}</span></p>
<p>Norm-2 (notion of distance)</p>
<p><span class="math">\begin{equation}
\lvert\lvert\overrightarrow{x}\lvert\lvert_2 = \sqrt{\sum_i^N |x_i|^2}
\end{equation}</span></p>
<p>The infinte-norm:</p>
<p><span class="math">\begin{equation}
\lvert\lvert\overrightarrow{x}\lvert\lvert_\infty = max_i  \{ |x_i| \}
\end{equation}</span></p>
<p>We can also define the n-norm, but the three previous one are most commonly used.</p>
<p><span class="math">\begin{equation}
\lvert\lvert\overrightarrow{x}\lvert\lvert_n = \sqrt[n]{\sum_i^N |x_i|^n}
\end{equation}</span></p>
<p>Use the 2nd norm ( np.linalg.norm() ) to see the evolution of the global error with the timestep.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">err_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nfig</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfig</span><span class="p">):</span>
    <span class="n">err_norm</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">err</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">err_norm</span><span class="p">)</span>
<span class="n">maxerr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">err_norm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">maxerr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Q1-(5)-–-calculate-an-error-function">
<h4>Q1 (5) – calculate an error function<a class="headerlink" href="#Q1-(5)-–-calculate-an-error-function" title="Permalink to this headline">¶</a></h4>
<p>Now see the influence of modifying the number of gridblocks and timestep and choose a good compromise between accuracy, and computation time.</p>
<p>What we want you to do, is to convert one of the previous cell, which does the computation of the solution and the error. That function should return one single real number, representing the norm of the error. We want you to define several timestep and gridsize (4-5 values max for each, otherwise computation time might be too important). So, loop over the different timesteps and gridsize you have chosen, call the function for each situation, and store the return of the function as an error.</p>
<p>In the end, we want you to plot the error in function of the timestep and gridsize, and chose the timestep you think is the best. A good compromise between accuracy and computation time is usually the best. In the rest of the assignment, we will go 2D. So, if your choice from here results in a too high computation time, the 2D calculation will take an important amount of time.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">compute_error</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the maximum error of the 1D transient diffusion problem</span>
<span class="sd">    n is the number of gridcells in the x-dimension</span>
<span class="sd">    dt is the timestep in days</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    err_norm: float</span>
<span class="sd">       the maximum normalized error found using np.linalg.norm</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1"># our solution copies the code from section 4.2 (Now solve the 1D problem)</span>
<span class="c1"># and uses it to fill  a matrix of the difference between that solution</span>
<span class="c1"># and the analytic answer  Here is the section that saves the error matrix</span>
<span class="c1">#</span>
<span class="c1"># for t in range(nTstp - 1):</span>
<span class="c1">#         for i in range(n):</span>
<span class="c1">#             Bdelta[i] =</span>
<span class="c1">#         bb =</span>
<span class="c1">#         v =</span>
<span class="c1">#         Time = Time + dt</span>
<span class="c1">#         if (t + 1) % n_of_tstep_before_fig == 0 and t &gt; 0:</span>
<span class="c1">#             for i in range(n):</span>
<span class="c1">#                 c[i, nfig] =</span>
<span class="c1">#                 denom =</span>
<span class="c1">#                 c_real[i] =</span>
<span class="c1">#                 err[i, nfig] =</span>
<span class="c1">#</span>
<span class="c1">#             nfig = nfig + 1</span>

<span class="c1">#     err_norm = np.zeros(nfig)</span>
<span class="c1">#     for i in range(nfig):</span>
<span class="c1">#         err_norm[i] =</span>
<span class="c1">#     maxerr = max(err_norm)</span>

<span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">maxerr</span>
</pre></div>
</div>
</div>
<p>In the next cell, we want you to use the previously defined function to compute the error for different values of the number_of_grid_cells and step_size, and give relevant values (incude appropriate plots) to justify your future choice. The next cell gives you an example of how we want you to work.</p>
<p>For your answer, save the error and the time_of_sim for at least 4 different values of number_of_grid_cells and step_size. The idea is to show the tradeoff between accuracy and the cost of the simulation. Make two plots, one showing error (mg/L) vs. timestep size (days) for your different choices of grid number, the second showing the simulation (“wallclock”) time vs. timestep size for the same grid number choices.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="n">number_of_grid_cells</span> <span class="o">=</span> <span class="mi">21</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">init_comp_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">compute_error</span><span class="p">(</span><span class="n">number_of_grid_cells</span><span class="p">,</span> <span class="n">step_size</span><span class="p">)</span>
<span class="n">time_of_sim</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">init_comp_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The error is: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2"> (mg/L)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The simulation wallclock time was </span><span class="si">{</span><span class="n">time_of_sim</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Q2-(5)-Plot-the-error-and-execution-time">
<h4>Q2 (5) Plot the error and execution time<a class="headerlink" href="#Q2-(5)-Plot-the-error-and-execution-time" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Here is an excerpt from our solution showing how we filled</span>
<span class="c1"># our error and simulation time matrices and made one of the</span>
<span class="c1"># plots</span>

<span class="c1"># nrows,ncols=error.shape</span>
<span class="c1"># for i in range(nrows):</span>
<span class="c1">#     for j in range(ncols):</span>
<span class="c1">#         init_comp_time = time.time()</span>
<span class="c1">#         error[i, j] =</span>
<span class="c1">#         sim_time[i, j] = time.time() - init_comp_time</span>

<span class="c1"># fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(8, 8))</span>
<span class="c1"># for i in range(nrows):</span>
<span class="c1">#     ax1.plot(</span>
<span class="c1">#</span>
<span class="c1">#     )</span>

<span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Q3-(3)-Find-the-“sweet-spot”">
<h4>Q3 (3) Find the “sweet spot”<a class="headerlink" href="#Q3-(3)-Find-the-“sweet-spot”" title="Permalink to this headline">¶</a></h4>
<p>Based on the results above, you should fix the value of n_x and dt. Do you see a “sweet spot” that provides the best tradeoff for accuracy vs. speed of simulation? Replace the <code class="docutils literal notranslate"><span class="pre">n_x</span></code> and <code class="docutils literal notranslate"><span class="pre">dt</span></code> values below with your choices.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n_x</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="c1"># Change the values given above</span>
<span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Here is a test to compare your choices against ours.</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="2D-transient-diffusion-in-homogeneous-media">
<h3>2D transient diffusion in homogeneous media<a class="headerlink" href="#2D-transient-diffusion-in-homogeneous-media" title="Permalink to this headline">¶</a></h3>
<p>Going from 1 to 2 dimensions changes nothing conceptually. There are, however a couple of changes required for the coding perspective. Indeed, whether the problem is 1D or 2D or 3D, the stucture of the system of equation Ac = b is the same. Matrix <span class="math notranslate nohighlight">\(A\)</span> will always be a <span class="math notranslate nohighlight">\(n \times n\)</span> matrix, while <span class="math notranslate nohighlight">\(c\)</span> and <span class="math notranslate nohighlight">\(b\)</span> will always be column vector of size <span class="math notranslate nohighlight">\(n\)</span>. In 2D, <span class="math notranslate nohighlight">\(n = n_x \times n_y\)</span>, while in 3D, it will be <span class="math notranslate nohighlight">\(n = n_x \times n_y \times n_z\)</span>. The individual
equation for a cell still produces a single row in the A and b matrices, but in 2D that cell has 4 neighbours instead of 2, and 3D it has 6 neighbors intead of 4.</p>
<p>However, the fact is that in every case, the solution is stored in one vector, representing either a 1/2/3D solution. For these higher dimension problems, a two-way conversion between vector and matrix is required. To plot the 2D result, for example, we will use colourmap plots, which require the solution to be plotted to be represented as a 2D array (matrix).</p>
<p>The function vec2mat(…) (specifically <span class="math notranslate nohighlight">\(vector\ to\ matrix\)</span>) does this: it converts a vector into the relevant 2D matrix, using n_x and n_y.</p>
<p>The reverse function is usually required to initialize the initial condition. It is mac2vec(…). These two functions are defined here below.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">mat2vec</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">):</span>
    <span class="c1">#</span>
    <span class="c1"># flatten a 2-dimensional concentration array</span>
    <span class="c1"># to one dimension, so it can be solved</span>
    <span class="c1"># with a matrix equation of the form A*x=b</span>
    <span class="c1">#</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">nrow</span> <span class="o">*</span> <span class="n">ncol</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">index_to_row_col</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">)</span>
        <span class="n">v</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">v</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">vec2mat</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">):</span>
    <span class="c1">#</span>
    <span class="c1"># return a flattened concentration matrix</span>
    <span class="c1"># to its 2-dimensional form for plotting</span>
    <span class="c1">#</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
            <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">c</span>
</pre></div>
</div>
</div>
<p>So, upto now, we have defined values for gridsize and timestep which provide a nice compromise between accuracy and computation time. We will use these values in the following.</p>
<p>We could perform the same analysis in 2D for the error. But we will here a focus on a nicer problem, in which there is a zone of very low diffusivity in the middle. We will let you decide which value to put there for diffusion, we will start by a diffusion 100 times lower. You can change that value if you want.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">decreasing_factor</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># Feel free to change if you want to see the impact</span>
<span class="c1"># (you can go higher than 1 ... But be careful, if diffusion speeds up significantly,</span>
<span class="c1"># the accuracy with respect to the chosen timestep might not be so good if you speed things up! )</span>
<span class="c1"># Initial value is 0.01</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Diff_low</span> <span class="o">=</span> <span class="n">Diff</span> <span class="o">*</span> <span class="n">decreasing_factor</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Here we define the initial condition, and the diffusion matrix for the 2D problem</span>

<span class="n">width_x</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># dm</span>
<span class="n">width_y</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># dm</span>
<span class="c1"># n_x should be defined by your previous analysis</span>
<span class="n">n_y</span> <span class="o">=</span> <span class="n">n_x</span>

<span class="n">D_matrix</span> <span class="o">=</span> <span class="n">Diff</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">))</span>
<span class="n">Qsource</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">))</span>
<span class="n">poro</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># days</span>
<span class="n">c_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width_x</span><span class="p">,</span> <span class="n">n_x</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">width_y</span><span class="p">,</span> <span class="n">n_y</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_y</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">c_init</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">c0</span>  <span class="c1"># Initial c ondition</span>
<span class="c1">#</span>
<span class="c1"># overwrite the center of the image iwth a low diffusivity</span>
<span class="c1">#</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_y</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_x</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">width_x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">width_x</span>
            <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">width_y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">width_y</span>
        <span class="p">):</span>
            <span class="n">D_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Diff_low</span>
            <span class="c1"># here we define a square of low diffusivity in the middle</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># This generates a colormap of diffusion.</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;magma&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">D_matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="c1"># &quot;magma&quot; refers to a colormap example. You can chose other ones</span>
<span class="c1"># https://matplotlib.org/examples/color/colormaps_reference.html</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Here we plot the initial condition using the colormap again</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># This generates a colormap of diffusion.</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;RdGy_r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c_init</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Here we give you the asymptotic solution to the problem</span>
<span class="c1"># we are using everything we have done before</span>

<span class="c1">### Asymptotic behavior</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">Problem_Def</span><span class="p">(</span><span class="n">n_x</span><span class="p">,</span> <span class="n">n_y</span><span class="p">,</span> <span class="n">poro</span><span class="p">,</span> <span class="n">width_x</span><span class="p">,</span> <span class="n">width_y</span><span class="p">)</span>
<span class="n">Qsource</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">))</span>
<span class="n">A</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">build_2D_matrix</span><span class="p">(</span><span class="n">bc_dict</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">D_matrix</span><span class="p">,</span> <span class="n">Qsource</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">n_x</span> <span class="o">*</span> <span class="n">n_y</span>
<span class="c1"># array v contains the solution</span>
<span class="c1"># we convert it in a matrix:</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">vec2mat</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">)</span>

<span class="c1"># and we plot the matrix</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="Q4-(2)-Comment-on-the-steady-state-solution">
<h4>Q4 (2) Comment on the steady state solution<a class="headerlink" href="#Q4-(2)-Comment-on-the-steady-state-solution" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Provide here a few comments on the asymptotic solution. What does your intuition tell you?</span>
<span class="c1"># For technical reasons, this is a python cell, so make your remarks a block comment</span>
<span class="c1"># or add your own markdown cell below this one it that&#39;s easier/clearer</span>
<span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Now we want you to solve the transient problem in the next cell. Everything you need has been defined</p>
<ul class="simple">
<li><p>the boundary conditions have been defined (bc_dict)</p></li>
<li><p>matrix A and b is known from the solution of the steady-state problem</p></li>
<li><p>every variable, parameter is known, as well as the initial condition in the matrix c_init</p></li>
</ul>
<p>We want you to perform a similar timeloop as we did for the 1D problem. We want you to save 9 different timesteps (including the initial one), which will be plotted in the cell after.</p>
<p>You need to initialize v from the initial condition, define the number of timesteps (hence the total duration of the simulation in days), define at which moment you want to save the concentration so that we can plot them later.</p>
<p>If you struggle organizing exactly plots at the right time, at least provide one plot similar to the one we have generated above.</p>
<p>Be careful, with a high amount of timesteps, it can take a few minutes to run. Start with only a few timesteps to make sure everything is working properly.</p>
<p>If you want to run the simulation until the steady-state is achieved, please do! You are welcome to present any result you want. The last cell is made so 9 different times are plotted. If you can’t make it, plot whatever you want in the cell above that one and put the boolean automated_plot to false!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">number_of_fig</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(((</span><span class="n">n_y</span><span class="p">,</span> <span class="n">n_x</span><span class="p">,</span> <span class="n">number_of_fig</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_fig</span><span class="p">):</span>
    <span class="n">c</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_init</span>
<span class="n">Tf</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">nTstp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Tf</span> <span class="o">/</span> <span class="n">dt</span><span class="p">)</span>  <span class="c1"># number of timesteps</span>
<span class="c1">#</span>
<span class="c1"># we set dt=0.25 days above, so 800 days will</span>
<span class="c1"># require 3200 timesteps</span>
<span class="c1">#</span>
<span class="n">n_of_tstep_before_fig</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nTstp</span> <span class="o">/</span> <span class="p">(</span><span class="n">number_of_fig</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>


<span class="c1"># We will plot the different slices of c in the end.</span>
<span class="c1"># You have to save the values of the solution at certain timesteps in c[:,:,New_timestep]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># This cell is empty so you can modify values of the cell above as needed</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Q5-(10)-Solve-for-the-2D-concentration-as-a-function-of-time">
<h4>Q5 (10) Solve for the 2D concentration as a function of time<a class="headerlink" href="#Q5-(10)-Solve-for-the-2D-concentration-as-a-function-of-time" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Now solve for the concetration c as a function of time</span>
<span class="c1"># Our solution fills the c array defined above with 9 separate</span>
<span class="c1"># 2D concentration fields spaced evenly throughout the 800 days of the simulation</span>
<span class="c1"># as shown in class</span>
<span class="c1">#</span>
<span class="c1"># Here is an excerpt from our solution showing how we filled our concentration array</span>
<span class="c1"># for t in range(nTstp):</span>
<span class="c1">#     for i in range(n):</span>
<span class="c1">#         Bdelta[i] =</span>
<span class="c1">#     bb =</span>
<span class="c1">#     v =</span>
<span class="c1">#     if (t + 1) % n_of_tstep_before_fig == 0:</span>
<span class="c1">#         c[:, :, nfig] =</span>
<span class="c1">#         nfig = nfig + 1</span>
<span class="c1">#         fig_timesteps.append(t)</span>
<span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Make a 2d contourf plot of the concentration for you final timestep here</span>
<span class="c1"># YOUR CODE HERE</span>
<span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># https://jdhao.github.io/2017/06/11/mpl_multiplot_one_colorbar/</span>
<span class="c1"># https://matplotlib.org/tutorials/toolkits/axes_grid.html</span>

<span class="n">automated_plot</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># set that to False if you don&#39;t want the automated 9 plots</span>
<span class="k">if</span> <span class="n">automated_plot</span><span class="p">:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

    <span class="n">ntimesteps</span> <span class="o">=</span> <span class="n">nfig</span>
    <span class="n">time_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">AxesGrid</span><span class="p">(</span>
        <span class="n">fig</span><span class="p">,</span>
        <span class="mi">111</span><span class="p">,</span>
        <span class="n">nrows_ncols</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
        <span class="n">axes_pad</span><span class="o">=</span><span class="mf">0.20</span><span class="p">,</span>
        <span class="n">cbar_mode</span><span class="o">=</span><span class="s2">&quot;single&quot;</span><span class="p">,</span>
        <span class="n">cbar_location</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">cbar_pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">time_index</span><span class="p">,</span> <span class="n">the_ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">time_steps</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
        <span class="n">the_ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">the_ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">time_index</span><span class="p">],</span> <span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">)</span>

    <span class="n">cbar</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">cbar_axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label_text</span><span class="p">(</span><span class="s2">&quot;Concentration (mg/L)&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="s2">&quot;Evolution of the concentration through time&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;evolution.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="Conclusions">
<h2>Conclusions<a class="headerlink" href="#Conclusions" title="Permalink to this headline">¶</a></h2>
<p>What you may have noticed, is that, even for small simple 2d transient problems like the one you have just solved, the computation times are already becoming significant…</p>
<p>This is partly because we are dealing with big matrix which are filled with zeros. It is a complete waste of time and memory to deal with all of these 0 values. There are other ways to make our calculation way faster. We will probably dedicate a lecture to understand how we can improve this.</p>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    <footer class="footer">
  <div class="container">
    <p>
          &copy; Copyright Numeric project.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>