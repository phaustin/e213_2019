

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Computation of the one-dimensional steady-state finite-volume approximation &#8212; Numeric course 0.1 documentation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link href="../_static/css/index.css" rel="stylesheet">
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">

<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
</button>

<div id="navbar-menu" class="collapse navbar-collapse">
  <ul id="navbar-main-elements" class="navbar-nav mr-auto">
    <li class="nav-item">
        <a class="nav-link" href="../index.html">Home</a>
    </li>
    
    
    <li class="nav-item ">
        <a class="nav-link" href="../learning_goals/learning_goals.html">Learning goals</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../week_notes.html">Weekly notes</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../solutions.html">Assignment solutions</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../texts.html">Texts</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../getting_started.html">Python</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../cheat_sheet.html">Cheat sheet</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../notebook_index.html">Notebook index</a>
    </li>
    
    
  </ul>
  <ul class="navbar-nav ml-auto">
    
    
  </ul>
</div>
    </nav>
    

    <div class="container-fluid">
      <div class="row">
          
          <div class="col-12 col-md-3 col-xl-2 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              


<div class="tocsection onthispage"><i class="fas fa-list"></i> On this page</div>
<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#1-D-steady---state-diffusion-stencil-(aligned-in-the-x-direction)" class="nav-link">1-D steady - state diffusion stencil (aligned in the x direction)</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Translation-into-a-computational-problem" class="nav-link">Translation into a computational problem</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Building-these-matrixes" class="nav-link">Building these matrixes</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#Assignment" class="nav-link">Assignment</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>
              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Computation-of-the-one-dimensional-steady-state-finite-volume-approximation">
<h1>Computation of the one-dimensional steady-state finite-volume approximation<a class="headerlink" href="#Computation-of-the-one-dimensional-steady-state-finite-volume-approximation" title="Permalink to this headline">¶</a></h1>
<p>We just developed the fundamental stencil for 1-D steady-state diffusion in terms of concentrations in gridblocks as:</p>
<div class="section" id="1-D-steady---state-diffusion-stencil-(aligned-in-the-x-direction)">
<h2>1-D steady - state diffusion stencil (aligned in the x direction)<a class="headerlink" href="#1-D-steady---state-diffusion-stencil-(aligned-in-the-x-direction)" title="Permalink to this headline">¶</a></h2>
<p>For every cell (gridblock) within the domain (not on the boundary), we can write that (for the steady-state), the sum of all fluxes is zero.</p>
<p><span class="math">\begin{align}
&\left(D\theta \frac{c_E - c_C}{\Delta x} +   D\theta \frac{c_W - c_E}{ \Delta x}   \right) (\Delta y) (\Delta z) = 0 \\
\end{align}</span></p>
<p>For the cells corresponding to the boundary problem, the equations are simple:</p>
<p><span class="math">\begin{equation}
c_{\mathrm{left}} = \text{Specified value for the left side of the domain}
\end{equation}</span> <span class="math">\begin{equation}
c_{\mathrm{right}} = \text{Specified value for the right side of the domain}
\end{equation}</span></p>
</div>
<div class="section" id="Translation-into-a-computational-problem">
<h2>Translation into a computational problem<a class="headerlink" href="#Translation-into-a-computational-problem" title="Permalink to this headline">¶</a></h2>
<p>We have seen that this stencil can be applied to any grid block and this lead to a system of <span class="math notranslate nohighlight">\(n\)</span> equations, where <span class="math notranslate nohighlight">\(n\)</span> is the number of gridblocks. These equations can be written in a matrix form</p>
<p><span class="math">\begin{equation}
Ac = b
\end{equation}</span></p>
<p>where A is a 2D matrix (<span class="math notranslate nohighlight">\(n \times n\)</span>), c is the solution vector (array of size <span class="math notranslate nohighlight">\(n\)</span>) and b is the right hand side (array of size <span class="math notranslate nohighlight">\(n\)</span>).</p>
<p>Apart from the boundary conditions, every line of this matrix represents the equation above:</p>
<p><span class="math">\begin{equation}
\left( -2  \frac{D\theta}{\Delta x} c_C + \frac{D\theta}{\Delta x}c_E + \frac{D\theta}{\Delta x} c_W \right) \Delta y \Delta z  = 0
\end{equation}</span></p>
<p>In a computational sense, this can be written as:</p>
<p><span class="math">\begin{equation}
\left( -2  \frac{D\theta}{\Delta x} c_{\left[i\right]}  + \frac{D\theta}{\Delta x}c_{\left[i-1\right]} +   \frac{D\theta}{\Delta x} c_{\left[i+1\right]} \right) \Delta y \Delta z  = 0
\end{equation}</span></p>
<p>Therefore, for line <span class="math notranslate nohighlight">\(i\)</span>, representing the <span class="math notranslate nohighlight">\(i^{th}\)</span> gridblock, the value for the <span class="math notranslate nohighlight">\(i-1\)</span> columnn of matrix <span class="math notranslate nohighlight">\(A\)</span> should be <span class="math">\begin{equation}
A\left[i \right]\left[i-1 \right] = + \frac{D\theta}{\Delta x}\Delta y \Delta z
\end{equation}</span></p>
<p>The value representing the contribution from the cell on the right (<span class="math notranslate nohighlight">\(i+1\)</span> column) is <span class="math">\begin{equation}
A\left[i \right]\left[i+1 \right] = + \frac{D\theta}{\Delta x}\Delta y \Delta z
\end{equation}</span></p>
<p>And the term on the diagonal is <span class="math">\begin{equation}
A\left[i \right]\left[i\right] = -2 \frac{D\theta}{\Delta x}\Delta y \Delta z
\end{equation}</span></p>
<p>The boundary conditions will be written as:</p>
<p><span class="math">\begin{equation}
c{\left[0\right]}   = c_{\text{left}}
\end{equation}</span> <span class="math">\begin{equation}
c{\left[n-1\right]}   = c_{\text{right}}
\end{equation}</span> So that means that the matrix A will have: <span class="math">\begin{equation}
A\left[0 \right]\left[0 \right] = 1
\end{equation}</span> <span class="math">\begin{equation}
A\left[n-1 \right]\left[n-1 \right] = 1
\end{equation}</span></p>
<p>And the boundary conditions have to be in the vector <span class="math notranslate nohighlight">\(b\)</span> (the right-hand-side): <span class="math">\begin{equation}
b{\left[0 \right]} = c_{\text{left}}
\end{equation}</span> <span class="math">\begin{equation}
b{\left[n-1 \right]} = c_{\text{right}}
\end{equation}</span></p>
</div>
<div class="section" id="Building-these-matrixes">
<h2>Building these matrixes<a class="headerlink" href="#Building-these-matrixes" title="Permalink to this headline">¶</a></h2>
<p>In the cell below, we have defined a function which builds the matrix A and the vector b. A lot of comments are given. We strongly advise you to make the link between the code and the previous equation. We don’t need you to be able to write this alone, or by memory, but to be able to understand these lines and adapt them.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="kn">import</span> <span class="n">assert_almost_equal</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">Build_1D_Matrix</span><span class="p">(</span><span class="n">c_left</span><span class="p">,</span> <span class="n">c_right</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Width</span><span class="p">,</span> <span class="n">poro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a coefficient matrix A and an array b related to the problem Ac = b.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    --------------</span>
<span class="sd">    c_left: (float)  left boundary condition for concentration [mg/L]</span>
<span class="sd">    c_right: (float) right boundary conditions for concentration [mg/L]</span>
<span class="sd">    n (int): amounts of cells/gridblocks [-]</span>
<span class="sd">    D (float): value of the diffusion coefficient (supposed the same everywhere) [m2/s]</span>
<span class="sd">    Width (float): Total physical width of the domain [m]</span>
<span class="sd">    poro (float): porosity value, supposed the same everywhere [-]</span>
<span class="sd">    Returns the matrix A, and the array b to solve the</span>
<span class="sd">    discretized 1D diffusion problem Ax = b</span>
<span class="sd">    ----------</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The name of this function is Build_1D_Matrix. We have to know its name to use it!</span>
    <span class="c1"># In this function, we will use the values of every parameters which are given to the function</span>
    <span class="c1"># ( c_left, c_right, n ,..): we have to use the same names and not overwrite these!</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>  <span class="c1"># This is the initialization of the square matrix &quot;A&quot;.</span>
    <span class="c1"># it is a n*n matrix which we initially fill with 0</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="c1"># b is the 1D array representing the RHS</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">Width</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># for a 10m width with 1 meter between cels, we need 11 cells</span>
    <span class="c1"># so, dx, which is the length between the cells, would be 1m (10/(11-1))</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">dz</span> <span class="o">=</span> <span class="n">dx</span> <span class="c1"># here it is assumed that all grid cells are cubes</span>
    <span class="n">coef</span> <span class="o">=</span> <span class="n">poro</span><span class="o">*</span><span class="n">D</span><span class="o">/</span><span class="n">dx</span><span class="o">*</span><span class="n">dy</span><span class="o">*</span><span class="n">dz</span>
    <span class="c1"># this coefficient is the one which appears in front of every term in the conservation equation</span>

    <span class="c1"># Now we are going to put the coefficients in the matrix A and in vector b.</span>
    <span class="c1"># So we are going to loop over every equation, each of them being described by one line of the matrix A</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># The first line represents the left boundary condition</span>
            <span class="c1"># the &quot;index&quot; i representing the left-value is 0</span>
            <span class="c1"># The equation for the left gridblock is:  1 * c[0] = c_left.</span>
            <span class="c1"># So, in the matrix form, the coefficicent associated with c[0] in line 0 is 1.</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c1"># while the RHS associated to that is bc_left</span>
            <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_left</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Same for the right side. the equation there is c[n-1] = c_right</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_right</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For every other node, we have to write the long equation.</span>
            <span class="n">East</span> <span class="o">=</span> <span class="n">coef</span>
            <span class="n">West</span> <span class="o">=</span> <span class="n">coef</span>
            <span class="c1"># In the future, these might not be precisely the same, so we define one for East and one for West.</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">East</span><span class="o">+</span><span class="n">West</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">East</span>
            <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span> <span class="n">West</span>
            <span class="c1"># As we indexed the unknowns from left to right, the unknow corresponding</span>
            <span class="c1"># to the concentration in the gridblock right to the i-th gridblock is the i+1 unknown</span>

            <span class="c1"># And, as there is nothing in the RHS in the equation above, the right hand side should be zero.</span>
            <span class="c1"># But, as it was initialized as 0, there is no need to be b[i] = 0 (it is alreay done !)</span>

            <span class="c1"># We could have written things like this below, this would be precisely the same:</span>
            <span class="c1"># A[i][i] = 2*coef</span>
            <span class="c1"># A[i][i+1] = - coef</span>
            <span class="c1"># A[i][i-1] = -coef</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">b</span>
    <span class="c1"># This last line is very important. It says that the function has to give back the matrix A and the array b.</span>
    <span class="c1"># Basically, when you call that function, specifying all the arguments, the function will give back these</span>
    <span class="c1"># two arrays, so that you can work with them.</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Here is an example of how to initialize and use the function.</span>
<span class="n">c_left</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># This is the left boundary condition</span>
<span class="n">c_right</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># This is the right boundary condition</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">51</span> <span class="c1"># This is the amount of cells</span>
<span class="n">Diff</span> <span class="o">=</span> <span class="mf">2e-9</span> <span class="c1"># This is the diffusion coefficicent</span>
<span class="n">Width</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># This is the width</span>
<span class="n">poro</span> <span class="o">=</span> <span class="mf">0.4</span>  <span class="c1"># This is the porosity</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Width</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="c1"># this defines the array of x-values</span>

<span class="c1">### here is the crucial part. We are going to call the function we created</span>
<span class="c1">### and provide it with our defined parameters</span>
<span class="n">A</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Build_1D_Matrix</span><span class="p">(</span><span class="n">c_left</span><span class="p">,</span> <span class="n">c_right</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">Diff</span><span class="p">,</span> <span class="n">Width</span><span class="p">,</span> <span class="n">poro</span><span class="p">)</span>
<span class="c1">### So here, A and b will be defined by the function, which returns A and b (you can use different name here if you want)</span>
<span class="c1">### ex: if you write, x,y = Build_1D_Matrix( ... ),</span>
<span class="c1">### basically, it says that x = the first returned value of the function (A),</span>
<span class="c1">### and y = the second value returned by the function (b). But here you can use whatever variable names you want.</span>

<span class="c1"># Basically we have set up our system of equation A c = b. Now we only need to solve it.</span>
<span class="c1"># There are numerical methods dedicated to that (we will study them in more depth later), but now, let&#39;s just use them</span>
<span class="c1"># Numpy has a set of linear algebra functions, one of which is &quot;solve&quot;, which we use like this:</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
<span class="c1"># this basically computes the solution of problem Ac = b and puts the values of the solution in an array c.</span>

<span class="c1">#Here is the plot of the result. You can see that on the left, c = 1, while on the right, c = 0 and observe a linear decrease.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Concentration&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x-axis (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Concentration (mg/L)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_6_finite_volume_6_3_0.png" src="../_images/web_notebooks_6_finite_volume_6_3_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Don&#39;t forget that you can always get help to  know what a function does,</span>
<span class="n">help</span><span class="p">(</span><span class="n">Build_1D_Matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on function Build_1D_Matrix in module __main__:

Build_1D_Matrix(c_left, c_right, n, D, Width, poro)
    Constructs a coefficient matrix A and an array b related to the problem Ac = b.
    Parameters:
    --------------
    c_left: (float)  left boundary condition for concentration [mg/L]
    c_right: (float) right boundary conditions for concentration [mg/L]
    n (int): amounts of cells/gridblocks [-]
    D (float): value of the diffusion coefficient (supposed the same everywhere) [m2/s]
    Width (float): Total physical width of the domain [m]
    poro (float): porosity value, supposed the same everywhere [-]
    Returns the matrix A, and the array b to solve the
    discretized 1D diffusion problem Ax = b
    ----------

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">err</span> <span class="o">=</span> <span class="n">b</span><span class="o">-</span><span class="n">A</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x7f1d5470ac88&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/web_notebooks_6_finite_volume_6_5_1.png" src="../_images/web_notebooks_6_finite_volume_6_5_1.png" />
</div>
</div>
<div class="section" id="Assignment">
<h3>Assignment<a class="headerlink" href="#Assignment" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>
<div class="section" id="Taking-into-account-a-source-term">
<h1>Taking into account a source term<a class="headerlink" href="#Taking-into-account-a-source-term" title="Permalink to this headline">¶</a></h1>
<p>So far, our diffusion problem is simple: solute (like sulfate) is diffusing from the high concentration side to the low concentration side. But it is also possible that chemical reactions could be occurring to produce or consume sulfate within the problem domain. We now want to account for this so-called source of mass in our discrete approximation.</p>
<p>Our assignment consists of three parts.</p>
<ol class="arabic simple">
<li><p>We want you to develop the correct 1-D steady-state discrete approximation stencil (W-C-E) in terms of concentrations for the situation where mass is being created within the domain by, for example, a chemical reaction.</p></li>
<li><p>We want you to modify the code to simulate diffusion with a so-called source term.</p></li>
<li><p>We want you to generalize the discrete approximation to 2 dimensions by adding N - S gridblocks above and below C.</p></li>
</ol>
<div class="section" id="Production-rates">
<h2>Production rates<a class="headerlink" href="#Production-rates" title="Permalink to this headline">¶</a></h2>
<p>For this problem, we will assume that in the zones where sulfate is being produced, the rate of production is given on a per mass of sediment basis. That is, for each kg of sediment, we assume that <span class="math notranslate nohighlight">\(xx~mg\)</span> of sulfate is generated each second; or that the source is <span class="math notranslate nohighlight">\(q=xxx~mg/kg\cdot s\)</span>, (in words, the source is xxx mg of mass being produced for every kg of sediment every second). Assume that the bulk density of the porous sediment is <span class="math notranslate nohighlight">\(\rho_{bulk}=2000~kg/m^3\)</span>. That is, the mass
of sediments in <span class="math notranslate nohighlight">\(1~m^3\)</span> of porous media is <span class="math notranslate nohighlight">\(2000~kg\)</span>.</p>
<p><strong>Problem</strong>: how much mass is produced every second in a gridblock of volume <span class="math notranslate nohighlight">\(v=5~m^3\)</span>?</p>
<p><strong>Note</strong> a negative rate indicates that mass is being consumed (for instance, sulfate could be consumed by sulfate-reducing bacteria).</p>
<p><strong>Source zone</strong></p>
<p>We will assume that there are reactive sulfide minerals only in the zone between <span class="math notranslate nohighlight">\(0.5 m\)</span> and <span class="math notranslate nohighlight">\(1~m\)</span>, where 0 m corresponds to the bottom boundary. This source <span class="math notranslate nohighlight">\(q\)</span> generates sulfate at a rate of 2.5$:nbsphinx-math:<cite>times</cite><span class="math notranslate nohighlight">\(10\)</span>^{-9}$ <span class="math notranslate nohighlight">\(mg/(kg\cdot s)\)</span>. But this source is not located everywhere: only between 0.5 and 1 meter.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># We define a source as an array of n elements, who are all zeros.</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># we assign every index between 0.5 and 1 meter (between 13-25) to the source</span>
<span class="n">Q</span><span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5e-9</span> <span class="c1">#mg/L/s</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="1.-Add-the-source-term-to-the-discrete-approximation">
<h1>1. Add the source term to the discrete approximation<a class="headerlink" href="#1.-Add-the-source-term-to-the-discrete-approximation" title="Permalink to this headline">¶</a></h1>
<p>To determine how to account for a source in our discrete approximation, recall our steady-state statement in its most fundamental (total flux) form:</p>
<p><span class="math">\begin{align}
J_{EC}+J_{WC} = 0\\
\end{align}</span></p>
<p>In words, this equation says: the <em>rate</em> of mass fluxing (either in or out) from E, plus the <em>rate</em> of mass fluxing either in or out from W sums to zero. Both <span class="math notranslate nohighlight">\(J_{WC}\)</span> and <span class="math notranslate nohighlight">\(J_{EC}\)</span> have dimensions of <span class="math notranslate nohighlight">\(\left[M\over T\right]\)</span>.</p>
<p>What if in addition to mass fluxing in and out by diffusion at rates <span class="math notranslate nohighlight">\(J_{WC}\)</span> and <span class="math notranslate nohighlight">\(J_{EC}\)</span>, mass is also being created inside C at some rate <span class="math notranslate nohighlight">\(Q~\left[M\over T\right]\)</span>? How does the fundamental equation change?</p>
<p>If you get that, then you can follow the steps from earlier notebooks where we developed this stencil for the sitation where there is no source:</p>
<p><span class="math">\begin{align}
&\left(D\theta {c_E - c_C \over \Delta x} +   D\theta {c_W - c_C \over \Delta x} \right) (\Delta y) (\Delta z) = 0 \\
\end{align}</span></p>
<p>We want you to write the equivalent stencil for the case where there is a source of mass <span class="math notranslate nohighlight">\(q ~ mg/(kg\cdot s)\)</span>.</p>
<div class="admonition note">
<p class="admonition-title"><strong>Your answer here</strong></p>
<p>Replace the 1-D steady-state fundamental equation below with the appropriate 1-D steady-state fundamental equation with a source term: <span class="math">\begin{align}
J_{EC}+J_{WC} = 0\\
\end{align}</span></p>
<p>Replace the 1-D steady-state W-C-E stencil below with the appropriate 1-D steady-state W-C-E stencil with a source of mass per unit mass of sediment:</p>
<p><span class="math">\begin{align}
&\left(D\theta {c_E - c_C \over \Delta x} +   D\theta {c_W - c_C \over \Delta x} \right) (\Delta y) (\Delta z) = 0 \\
\end{align}</span></p>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    <footer class="footer">
  <div class="container">
    <p>
          &copy; Copyright Numeric project.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>